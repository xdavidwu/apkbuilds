# Contributor: Milan P. StaniÄ‡ <mps@arvanta.net>
# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: xdavidwu <xdavidwuph@gmail.com>
pkgname=iwd-systemd
pkgver=1.26
pkgrel=0
pkgdesc="Internet Wireless Daemon (systemd units)"
url="https://iwd.wiki.kernel.org/"
arch="noarch"
license="LGPL-2.1-or-later"
makedepends="dbus-dev readline-dev linux-headers systemd-dev"
options="!check" # some builders fail on some test
checkdepends="coreutils"
install_if="iwd systemd"
source="https://mirrors.edge.kernel.org/pub/linux/network/wireless/iwd-$pkgver.tar.gz"
builddir="$srcdir/iwd-$pkgver"

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--enable-systemd-service \
		--enable-sim-hardcoded \
		--enable-wired \
		--enable-tools
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install

	rm -rf "$pkgdir"/etc
	rm -rf "$pkgdir"/usr/bin
	rm -rf "$pkgdir"/usr/libexec
	rm -rf "$pkgdir"/usr/share/dbus-1/system.d
	rm -rf "$pkgdir"/usr/share/man
}

sha512sums="
e67026d512936bbccb5f5e717031a26d8edb5046edb82923dd6a61d5645401a9718f46376f325cfc72c34d1ca0ab2ca07f3b25c2fc349196c73998b53824ed0e  iwd-1.26.tar.gz
"
